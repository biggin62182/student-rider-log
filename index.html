<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Student Rider Log</title>
  <style>body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;background:#0b0c10;color:#e8eaf0}
  .wrap{max-width:1200px;margin:24px auto;padding:0 16px}
  .card{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);border-radius:14px;overflow:hidden}
  form{padding:20px;display:grid;gap:16px}
  .grid{display:grid;gap:12px}.cols-2{grid-template-columns:1fr 1fr}.cols-3{grid-template-columns:repeat(3,1fr)}@media(max-width:780px){.cols-2,.cols-3{grid-template-columns:1fr}}
  label{display:block;font-size:14px;color:#a0a6b3;margin-bottom:6px}
  input,select,button{font:inherit}input,select{width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.14);background:rgba(15,17,23,.85);color:#e8eaf0}
  .week-grid{display:flex;gap:10px;overflow-x:auto;padding:4px 2px 8px;-webkit-overflow-scrolling:touch;scroll-snap-type:x mandatory}
  .dayCard{flex:0 0 260px;min-width:260px;scroll-snap-align:start;border:1px solid rgba(255,255,255,.12);border-radius:12px;background:rgba(255,255,255,.03);padding:10px}
  .twoCol{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .toolbar{padding:14px 20px;border-top:1px solid rgba(255,255,255,.08);display:flex;gap:8px;justify-content:flex-end;background:rgba(0,0,0,.15)}
  .btn{padding:9px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:rgba(122,193,255,.15);color:#e8eaf0;cursor:pointer;font-weight:700;font-size:13px}
  .btn.secondary{background:rgba(255,255,255,.06)}.btn.success{background:rgba(56,211,159,.2);border-color:rgba(56,211,159,.35)}.btn.danger{background:rgba(255,107,107,.18);border-color:rgba(255,107,107,.25)}
  .submissions{margin-top:22px}.actions{display:flex;gap:6px;flex-wrap:wrap}.empty{padding:14px;color:#a0a6b3;border:1px dashed rgba(255,255,255,.18);border-radius:12px;text-align:center}
  table{width:100%;border-collapse:separate;border-spacing:0;border:1px solid rgba(255,255,255,.08);border-radius:12px;background:rgba(255,255,255,.02);min-width:1100px}
  thead th{font-size:12.5px;color:#a0a6b3;padding:8px 10px;background:rgba(0,0,0,.25);text-align:left;white-space:nowrap}
  tbody td{padding:8px 10px;border-top:1px solid rgba(255,255,255,.06);font-size:13px;white-space:nowrap}
  #printArea{display:none}@media print{@page{size:Letter landscape;margin:.35in}body{background:#fff;color:#000}form,.submissions{display:none!important}#printArea{display:block!important}}</style>
</head>
<body>
  <div class="wrap">
    <section class="card">
      <form id="riderForm">
        <input type="hidden" id="recordId" />
        <div class="grid cols-3">
          <div><label for="weekOf">Week of</label><input id="weekOf" type="date" /></div>
          <div style="grid-column: span 2;"><label for="studentName">Student name *</label><input id="studentName" required /></div>
        </div>
        <div class="grid cols-2">
          <div><label for="street">Street address *</label><input id="street" required /></div>
          <div><label for="street2">Apt / Unit</label><input id="street2" /></div>
        </div>
        <div class="grid cols-3">
          <div><label for="city">City *</label><input id="city" required /></div>
          <div><label for="state">State *</label>
            <select id="state" required><option value="">Select…</option><option>MO</option><option>KS</option><option>IL</option><option>IA</option><option>NE</option><option>OK</option></select>
          </div>
          <div><label for="zip">ZIP *</label><input id="zip" placeholder="64016 or 64016-1234" /></div>
        </div>
        <div class="grid cols-3">
          <div><label for="homeDistrict">Home Address District *</label><input id="homeDistrict" required /></div>
          <div><label for="schoolName">School Attending</label><input id="schoolName" /></div>
          <div><label for="schoolDistrict">Attending District *</label><input id="schoolDistrict" required /></div>
        </div>
        <fieldset>
          <legend>Weekly ride log: Rode, NS (no show), Sick, Car Rider, No School</legend>
          <div id="daysContainer" class="week-grid"></div>
          <template id="optionTemplate">
            <option value="">—</option><option>Rode</option><option>NS (no show)</option><option>Sick</option><option>Car Rider</option><option>No School</option>
          </template>
          <template id="dayTemplate">
            <div class="dayCard">
              <div style="font-size:13px;color:#a0a6b3;font-weight:700;text-transform:uppercase" data-day-label></div>
              <div class="twoCol"><div><label>AM</label><select data-am></select></div><div><label>PM</label><select data-pm></select></div></div>
            </div>
          </template>
        </fieldset>
        <div class="toolbar">
          <button type="button" class="btn secondary" id="btnNew">New entry</button>
          <button type="reset" class="btn secondary">Reset</button>
          <button type="submit" class="btn" id="btnSave">Save entry</button>
        </div>
      </form>
    </section>

    <section class="submissions">
      <div style="display:flex;justify-content:space-between;align-items:center;margin:10px 0;"><h2 style="margin:0;font-size:18px;">Saved entries</h2></div>
      <div class="actions" style="gap:10px;flex-wrap:wrap;margin:10px 0">
        <div>
          <label for="studentPicker" style="display:block;font-size:12px;color:#a0a6b3">Student</label>
          <select id="studentPicker"></select>
        </div>
        <div>
          <label for="weekPicker" style="display:block;font-size:12px;color:#a0a6b3">Saved week</label>
          <select id="weekPicker"></select>
        </div>
        <button id="qpEdit" class="btn secondary" type="button">Edit</button>
        <button id="qpPdf" class="btn" type="button">PDF</button>
        <button id="qpDup" class="btn success" type="button">Duplicate → New Week</button>
        <span style="flex:1 1 auto"></span>
        <button id="btnExport" class="btn secondary" type="button">Export</button>
        <button id="btnImport" class="btn" type="button">Import…</button><input id="importFile" type="file" accept="application/json" style="display:none" />
      </div>
      <details style="margin:10px 0">
        <summary style="color:#a0a6b3">Show all saved entries (optional)</summary>
        <div style="overflow:auto;margin-top:8px">
          <table id="dataTable"><thead><tr><th>Actions</th><th>Week of</th><th>Student</th><th>Address</th><th>Home district</th><th>School</th><th>Attending district</th><th>Mon AM</th><th>Mon PM</th><th>Tue AM</th><th>Tue PM</th><th>Wed AM</th><th>Wed PM</th><th>Thu AM</th><th>Thu PM</th><th>Fri AM</th><th>Fri PM</th><th>Saved</th></tr></thead><tbody id="tableBody"></tbody></table>
        </div>
      </details>
      <div id="emptyState" class="empty">No entries yet. Add your first student above.</div>
    </section>
  </div>
  <div id="printArea" aria-hidden="true"></div>
<script>
(function(){
  const KEY="student_rider_records_v1";
  const form=document.getElementById("riderForm");
  const tbody=document.getElementById("tableBody");
  const empty=document.getElementById("emptyState");
  const weekOf=document.getElementById("weekOf");
  const recordId=document.getElementById("recordId");
  const studentPicker=document.getElementById("studentPicker");
  const weekPicker=document.getElementById("weekPicker");
  const qpEdit=document.getElementById("qpEdit");
  const qpPdf=document.getElementById("qpPdf");
  const qpDup=document.getElementById("qpDup");

  const days=[{key:'mon',label:'Monday'},{key:'tue',label:'Tuesday'},{key:'wed',label:'Wednesday'},{key:'thu',label:'Thursday'},{key:'fri',label:'Friday'}];
  function buildDays(){
    const cont=document.getElementById("daysContainer");
    const dayTpl=document.getElementById("dayTemplate");
    const optTpl=document.getElementById("optionTemplate");
    cont.innerHTML="";
    days.forEach(({key,label})=>{
      const node=dayTpl.content.firstElementChild.cloneNode(true);
      node.querySelector("[data-day-label]").textContent=label;
      const am=node.querySelector("[data-am]");const pm=node.querySelector("[data-pm]");
      am.id=key+"Am"; pm.id=key+"Pm"; am.appendChild(optTpl.content.cloneNode(true)); pm.appendChild(optTpl.content.cloneNode(true));
      cont.appendChild(node);
    });
  }
  function startOfWeekMonday(date){const d=new Date(date);const day=d.getDay();const diff=(day===0?-6:1-day);d.setDate(d.getDate()+diff);d.setHours(0,0,0,0);return d;}
  function toInputDate(d){return d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,'0')+"-"+String(d.getDate()).padStart(2,'0');}
  function renderDefaultWeek(){ if(!weekOf.value){ weekOf.value=toInputDate(startOfWeekMonday(new Date())); } }
  function load(){ try{return JSON.parse(localStorage.getItem(KEY)||"[]");}catch{return[]} }
  function save(all){ localStorage.setItem(KEY, JSON.stringify(all)); }
  function genId(){ return (crypto.randomUUID?crypto.randomUUID():Date.now().toString(36)+Math.random().toString(36).slice(2)); }
  function fmtAddr(r){ const l2=r.street2?(", "+r.street2):""; return `${r.street}${l2}, ${r.city}, ${r.state} ${r.zip}`; }
  function getWeekVal(w,day,ap){ if(!w) return ""; const c=[day+ap, day+ap.toUpperCase(), day+ap.toLowerCase(), day[0].toUpperCase()+day.slice(1)+ap, day.toUpperCase()+ap, day+"_"+ap, day+"-"+ap]; for(const k of c){ if(Object.prototype.hasOwnProperty.call(w,k)){ const v=w[k]; return v==null?"":String(v).trim(); } } return ""; }
  function normalizeShort(v){ if(!v) return ""; return String(v).replace(/NS \(no show\)/gi,"NS").replace(/Car Rider/gi,"Car").replace(/No School/gi,"Closed").trim(); }

  buildDays(); renderDefaultWeek();

  form.addEventListener("submit",(e)=>{
    e.preventDefault();
    const w={monAm:monAm.value,monPm:monPm.value,tueAm:tueAm.value,tuePm:tuePm.value,wedAm:wedAm.value,wedPm:wedPm.value,thuAm:thuAm.value,thuPm:thuPm.value,friAm:friAm.value,friPm:friPm.value};
    const d={
      id:recordId.value||"", weekOf:weekOf.value, studentName:studentName.value.trim(),
      street:street.value.trim(), street2:street2.value.trim(), city:city.value.trim(), state:state.value.trim(), zip:zip.value.trim(),
      homeDistrict:homeDistrict.value.trim(), schoolName:schoolName.value.trim(), schoolDistrict:schoolDistrict.value.trim(),
      week:w, savedAt:new Date().toISOString()
    };
    const all=load();
    const original=all.find(r=>r.id===d.id);
    if(original && (original.studentName!==d.studentName || original.weekOf!==d.weekOf)){ d.id=""; }
    const rec={...d, id:d.id||genId()};
    const idx=all.findIndex(r=>r.id===rec.id);
    if(idx>=0) all[idx]=rec; else all.unshift(rec);
    save(all); render(); recordId.value=rec.id; alert("Saved.");
  });

  function enterEdit(r){
    recordId.value=r.id; weekOf.value=r.weekOf||""; studentName.value=r.studentName||"";
    street.value=r.street||""; street2.value=r.street2||""; city.value=r.city||""; state.value=r.state||""; zip.value=r.zip||"";
    homeDistrict.value=r.homeDistrict||""; schoolName.value=r.schoolName||""; schoolDistrict.value=r.schoolDistrict||"";
    const w=r.week||{}; monAm.value=getWeekVal(w,'mon','Am'); monPm.value=getWeekVal(w,'mon','Pm'); tueAm.value=getWeekVal(w,'tue','Am'); tuePm.value=getWeekVal(w,'tue','Pm');
    wedAm.value=getWeekVal(w,'wed','Am'); wedPm.value=getWeekVal(w,'wed','Pm'); thuAm.value=getWeekVal(w,'thu','Am'); thuPm.value=getWeekVal(w,'thu','Pm');
    friAm.value=getWeekVal(w,'fri','Am'); friPm.value=getWeekVal(w,'fri','Pm');
    window.scrollTo({top:0,behavior:'smooth'});
  }
  function duplicateToNextWeek(r){
    const base=r.weekOf?new Date(r.weekOf):new Date(); const s=new Date(base); s.setDate(s.getDate()-s.getDay()); s.setDate(s.getDate()+7);
    const weekOf=toInputDate(s);
    const nw={...r, id:genId(), weekOf, week:{monAm:"",monPm:"",tueAm:"",tuePm:"",wedAm:"",wedPm:"",thuAm:"",thuPm:"",friAm:"",friPm:""}, savedAt:new Date().toISOString()};
    const all=load(); all.unshift(nw); save(all); render(); enterEdit(nw);
  }

  function render(){
    const rows=load(); empty.style.display=rows.length?"none":"block"; tbody.innerHTML="";
    populateQuick(rows);
    rows.forEach(r=>{
      const tr=document.createElement('tr');
      const tda=document.createElement('td'); const actions=document.createElement('div'); actions.className='actions';
      const bE=document.createElement('button'); bE.className='btn secondary'; bE.textContent='Edit'; bE.onclick=()=>enterEdit(r);
      const bD=document.createElement('button'); bD.className='btn success'; bD.textContent='Duplicate → New Week'; bD.onclick=()=>duplicateToNextWeek(r);
      const bP=document.createElement('button'); bP.className='btn'; bP.textContent='PDF'; bP.onclick=()=>printWeeks([r]);
      const bX=document.createElement('button'); bX.className='btn danger'; bX.textContent='Delete'; bX.onclick=()=>{ if(confirm('Confirm delete?')){ const all=load().filter(x=>x.id!==r.id); save(all); render(); } };
      [bE,bD,bP,bX].forEach(b=>actions.appendChild(b)); tda.appendChild(actions); tr.appendChild(tda);
      const addr=fmtAddr(r);
      const w=r.week||{};
      const cells=[r.weekOf?new Date(r.weekOf).toLocaleDateString():"", r.studentName||"", addr, r.homeDistrict||"", r.schoolName||"", r.schoolDistrict||"",
        getWeekVal(w,'mon','Am'),getWeekVal(w,'mon','Pm'),getWeekVal(w,'tue','Am'),getWeekVal(w,'tue','Pm'),getWeekVal(w,'wed','Am'),getWeekVal(w,'wed','Pm'),
        getWeekVal(w,'thu','Am'),getWeekVal(w,'thu','Pm'),getWeekVal(w,'fri','Am'),getWeekVal(w,'fri','Pm'), new Date(r.savedAt).toLocaleString()];
      cells.forEach(v=>{const td=document.createElement('td'); td.textContent=v; tr.appendChild(td);});
      tbody.appendChild(tr);
    });
  }
  function populateQuick(rows){
    const students=[...new Set(rows.map(r=>r.studentName).filter(Boolean))].sort((a,b)=>a.localeCompare(b));
    studentPicker.innerHTML="<option value=''>— Select student —</option>"+students.map(s=>`<option>${s}</option>`).join("");
    weekPicker.innerHTML="<option value=''>— Select week —</option>";
  }
  studentPicker.addEventListener("change",(e)=>{
    const s=e.target.value; const rows=load().filter(r=>r.studentName===s); const weeks=[...new Set(rows.map(r=>r.weekOf).filter(Boolean))].sort((a,b)=>a>b?-1:1);
    weekPicker.innerHTML="<option value=''>— Select week —</option>"+weeks.map(w=>`<option value='${w}'>${new Date(w).toLocaleDateString()}</option>`).join("");
  });
  function getSelected(){ const s=studentPicker.value, w=weekPicker.value; if(!s||!w) return null; const rows=load().filter(r=>r.studentName===s&&r.weekOf===w); if(!rows.length) return null; rows.sort((a,b)=>new Date(b.savedAt)-new Date(a.savedAt)); return rows[0]; }
  qpEdit.onclick=()=>{ const r=getSelected(); if(!r) return alert("Pick a student and week."); enterEdit(r); };
  qpPdf.onclick=()=>{ const r=getSelected(); if(!r) return alert("Pick a student and week."); printWeeks([r]); };
  qpDup.onclick=()=>{ const r=getSelected(); if(!r) return alert("Pick a student and week."); duplicateToNextWeek(r); };

  const printArea=document.getElementById("printArea");
  function cell(t){const td=document.createElement('td'); td.textContent=t||"—"; return td;}
  function makeCard(r){
    const sec=document.createElement('section'); sec.style.background="#fff"; sec.style.color="#000"; sec.style.padding="10px"; sec.style.margin="6px 0"; sec.style.border="1px solid #999"; sec.style.borderRadius="10px";
    const h=document.createElement('div'); h.style.display="flex"; h.style.justifyContent="space-between"; h.style.marginBottom="6px";
    const t=document.createElement('div'); t.style.fontWeight="800"; t.textContent="Student Rider Log — Weekly Report";
    const m=document.createElement('div'); m.style.fontSize="12px"; m.textContent="Saved: "+new Date(r.savedAt||Date.now()).toLocaleString();
    h.appendChild(t); h.appendChild(m); sec.appendChild(h);
    const info=document.createElement('div'); info.textContent=`Week of ${r.weekOf?new Date(r.weekOf).toLocaleDateString():""}  •  Student ${r.studentName||""}  •  Address ${fmtAddr(r)}`; info.style.fontSize="12px"; sec.appendChild(info);
    const table=document.createElement('table'); table.style.width="100%"; table.style.borderCollapse="collapse"; table.style.marginTop="6px";
    const thead=document.createElement('thead'); const trh=document.createElement('tr'); ["Day","AM","PM"].forEach(x=>{const th=document.createElement('th'); th.textContent=x; th.style.borderBottom="1px solid #bbb"; th.style.textAlign="left"; th.style.padding="6px"; trh.appendChild(th);}); thead.appendChild(trh); table.appendChild(thead);
    const tb=document.createElement('tbody');
    const w=r.week||{};
    const rows=[["Monday",getWeekVal(w,'mon','Am'),getWeekVal(w,'mon','Pm')],["Tuesday",getWeekVal(w,'tue','Am'),getWeekVal(w,'tue','Pm')],["Wednesday",getWeekVal(w,'wed','Am'),getWeekVal(w,'wed','Pm')],["Thursday",getWeekVal(w,'thu','Am'),getWeekVal(w,'thu','Pm')],["Friday",getWeekVal(w,'fri','Am'),getWeekVal(w,'fri','Pm')]];
    rows.forEach(row=>{const tr=document.createElement('tr'); tr.appendChild(cell(row[0])); tr.appendChild(cell(row[1])); tr.appendChild(cell(row[2])); tb.appendChild(tr);});
    table.appendChild(tb); sec.appendChild(table); return sec;
  }
  function printWeeks(recs){ if(!recs||!recs.length) return alert("Nothing to print."); printArea.innerHTML=""; recs.forEach((r,i)=>{ printArea.appendChild(makeCard(r)); if(i<recs.length-1){ const br=document.createElement('div'); br.style.pageBreakAfter='always'; printArea.appendChild(br);} }); setTimeout(()=>window.print(),10); }
  render();
})();</script>
</body></html>
